#+---------------+
# General Config +
#+---------------+
unbind c-b
set -g prefix c-g
bind c-g send-prefix
set -g display-panes-time 2000
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:rgb"
set -g default-shell /bin/zsh
set -g mouse on
set -g focus-events on
set -s copy-command 'pbcopy' # https://github.com/tmux/tmux/wiki/clipboard#external-tools
set -s escape-time 50
setw -g mode-keys vi
set -g status-interval 1
set -g @catppuccin_flavor "frappe"
set -g @thm_deeper_crust "#1c1e2a"

#+----------------------------+
# Window and Panel Appearance +
#+----------------------------+
set -gF window-style 'bg=#{@thm_deeper_crust}'
set -g window-active-style 'bg=terminal'
setw -g pane-border-lines single

#+-------------+
# Key Bindings +
#+-------------+
bind / split-window -h -c '#{pane_current_path}'
bind ? split-window -p 20 -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'
bind _ split-window -p 20 -v -c '#{pane_current_path}'

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind J resize-pane -D 5
bind K resize-pane -U 5
bind H resize-pane -L 5
bind L resize-pane -R 5

bind @ choose-tree 'join-pane -h -s "%%"'
bind c new-window -a -t '{end}' -c '#{pane_current_path}'
bind ^ confirm-before -p "Kill session? (y/n)" kill-session

unbind r
bind r source-file "~/.config/tmux/tmux.conf" \; display "reloaded tmux conf"

bind-key -T copy-mode-vi v      send-keys -X begin-selection
bind-key -T copy-mode-vi c-v    send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y      send-keys -X copy-selection

run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux # https://github.com/catppuccin/tmux

#+-------+
# Status +
#+-------+
set -g status-position top
set -g status-style "bg=terminal"
set -g status-justify absolute-centre

#+--------------+
# Window Status +
#+--------------+
set -g @sep_begin " "
set -g @sep_end ""
set -gF @tab_active "#{@thm_fg}"
set -gF @tab_inactive  "#{@thm_crust}"

set -g window-status-style "bg=terminal"

set -g window-status-format ""
set -ga window-status-format "#{?#{e|>:#{session_windows},1},"
set -ga window-status-format "#[fg=#{@thm_bg}#,bg=#{@tab_inactive}#,nobold#,noitalics#,nounderscore]#{@sep_begin}"
set -ga window-status-format "#[fg=white#,bg=#{@tab_inactive}]#I #[fg=white#,bg=#{@tab_inactive}#,nobold#,noitalics#,nounderscore]#[fg=white#,bg=#{@tab_inactive}]#W #F "
set -ga window-status-format "#[fg=#{@tab_inactive}#,bg=#{@thm_bg}#,nobold#,noitalics#,nounderscore]#{@sep_end}"
set -ga window-status-format ",}"

set -g window-status-current-format ""
set -ga window-status-current-format "#{?#{e|>:#{session_windows},1},"
set -ga window-status-current-format "#[fg=#{@thm_bg}#,bg=#{@tab_active}#,nobold#,noitalics#,nounderscore]#{@sep_begin}"
set -ga window-status-current-format "#[fg=black#,bg=#{@tab_active}#,bold]#I #[fg=black#,bg=#{@tab_active}#,nobold#,noitalics#,nounderscore]#[fg=black#,bg=#{@tab_active}#,bold]#W #F "
set -ga window-status-current-format "#[fg=#{@tab_active}#,bg=#{@thm_bg}#,nobold#,noitalics#,nounderscore]#{@sep_end}"
set -ga window-status-current-format ",}"

#+-------+
# Status +
#+-------+
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#[bg=terminal,fg=#{@thm_fg}] #S "
set -ga status-left "#[bg=terminal,fg=#{@thm_overlay_0}, none]|"
set -ga status-left "#[bg=terminal,fg=#{@thm_fg}] #{b:pane_current_path}"

set -gF @cpu_low_fg_color "#[fg=#{@thm_fg}]"
set -gF @cpu_medium_fg_color "#[fg=#{@thm_pink}]"
set -gF @cpu_high_fg_color "#[fg=#{@thm_red}]"
set -gF @ram_low_fg_color "#[fg=#{@thm_fg}]"
set -gF @ram_medium_fg_color "#[fg=#{@thm_pink}]"
set -gF @ram_high_fg_color "#[fg=#{@thm_red}]"

set -g status-right-length 100
set -g status-right ""
set -ga status-right "#{cpu_fg_color}#[bg=terminal]   #{cpu_percentage} "
set -ga status-right "#[bg=terminal,fg=#{@thm_overlay_0}, none]|"
set -ga status-right "#{ram_fg_color}#[bg=terminal]   #{ram_percentage} "
set -ga status-right "#[bg=terminal,fg=#{@thm_overlay_0}, none]|"
set -ga status-right "#[bg=terminal,fg=#{@thm_fg}] 󰤆 #(uptime | sed 's/^[^,]*up *//; s/, *[[:digit:]]* user.*//; s/ day.*, */d /; s/ hr\\(s*\\).*/h/; s/ min\\(s*\\).*/m/; s/ sec\\(s*\\).*/s/; s/\\([0-9]\\{1,2\\}\\):\\([0-9]\\{1,2\\}\\)/\\1h \\2m/;') "

run ~/.config/tmux/plugins/tmux-cpu/cpu.tmux # https://github.com/tmux-plugins/tmux-cpu

set -gF mode-style "bg=#{@thm_fg},fg=#{@thm_bg}"
